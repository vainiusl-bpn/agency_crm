{% extends "base.html" %}

{% block title %}{{ company.name }} - Agency CRM{% endblock %}

{% block content %}
<div class="pb-5 border-b border-gray-200 sm:flex sm:items-center sm:justify-between">
    <div>
        <h3 class="text-2xl font-semibold leading-6 text-gray-900">{{ company.name }}</h3>
        <p class="mt-1 max-w-2xl text-sm text-gray-500">
            {% if company.status == 'active' %}
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    Active
                </span>
            {% else %}
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                    Inactive
                </span>
            {% endif %}
        </p>
    </div>
    <div class="mt-3 flex sm:mt-0 sm:ml-4 space-x-3">
        <a href="{{ url_for('clients.edit_company', company_id=company.id) }}" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
            <i class="fas fa-edit mr-2"></i> Edit
        </a>
        <a href="{{ url_for('clients.upload_agreement', company_id=company.id) }}" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
            <i class="fas fa-file-upload mr-2"></i> Upload Agreement
        </a>
        <a href="{{ url_for('clients.add_commitment', company_id=company.id) }}" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700">
            <i class="fas fa-handshake mr-2"></i> Add Commitment
        </a>
        {% if not company.parent_company_id %}
        <form action="{{ url_for('clients.delete_company', company_id=company.id) }}" method="POST" class="inline" onsubmit="return confirm('Are you sure you want to delete this company? This will permanently delete the company and ALL related data including brands, agreements, commitments, and invoices. This action cannot be undone.');">
            <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700">
                <i class="fas fa-trash mr-2"></i> Delete Company
            </button>
        </form>
        {% endif %}
    </div>
</div>

<div class="mt-6 grid grid-cols-1 gap-6 lg:grid-cols-2">
    <div class="bg-white shadow overflow-hidden sm:rounded-lg">
        <div class="px-4 py-5 sm:px-6">
            <h3 class="text-lg leading-6 font-medium text-gray-900">Company Information</h3>
        </div>
        <div class="border-t border-gray-200">
            <dl>
                <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                    <dt class="text-sm font-medium text-gray-500">Company Name</dt>
                    <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">{{ company.name }}</dd>
                </div>
                <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                    <dt class="text-sm font-medium text-gray-500">VAT Code</dt>
                    <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">{{ company.vat_code or 'Not provided' }}</dd>
                </div>
                <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                    <dt class="text-sm font-medium text-gray-500">Registration Number</dt>
                    <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">{{ company.registration_number or 'Not provided' }}</dd>
                </div>
                <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                    <dt class="text-sm font-medium text-gray-500">Address</dt>
                    <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">{{ company.address or 'Not provided' }}</dd>
                </div>
                <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                    <dt class="text-sm font-medium text-gray-500">Bank Account</dt>
                    <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">{{ company.bank_account or 'Not provided' }}</dd>
                </div>
                <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                    <dt class="text-sm font-medium text-gray-500">Created</dt>
                    <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">{{ company.created_at.strftime('%Y-%m-%d %H:%M') }}</dd>
                </div>
            </dl>
        </div>
    </div>

    <div class="bg-white shadow overflow-hidden sm:rounded-lg">
        <div class="px-4 py-5 sm:px-6 flex justify-between items-center">
            <h3 class="text-lg leading-6 font-medium text-gray-900">Brands</h3>
            <a href="{{ url_for('clients.new_brand', company_id=company.id) }}" class="text-sm text-indigo-600 hover:text-indigo-500">
                Add Brand
            </a>
        </div>
        <div class="border-t border-gray-200">
            <ul class="divide-y divide-gray-200">
                {% for brand in company.brands %}
                <li class="px-4 py-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-900">{{ brand.name }}</p>
                            <p class="text-sm text-gray-500">{{ brand.team_members|length }} team members</p>
                        </div>
                        <a href="{{ url_for('clients.brand_detail', brand_id=brand.id) }}" class="text-indigo-600 hover:text-indigo-900 text-sm">
                            View →
                        </a>
                    </div>
                </li>
                {% else %}
                <li class="px-4 py-4 text-sm text-gray-500">No brands yet</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>

{% if company.agency_fees %}
<div class="mt-6">
    <div class="bg-white shadow overflow-hidden sm:rounded-lg">
        <div class="px-4 py-5 sm:px-6">
            <h3 class="text-lg leading-6 font-medium text-gray-900">Agency Fees</h3>
        </div>
        <div class="border-t border-gray-200 px-4 py-5 sm:px-6">
            <div class="text-sm text-gray-900 whitespace-pre-line">{{ company.agency_fees }}</div>
        </div>
    </div>
</div>
{% endif %}

<div class="mt-6 grid grid-cols-1 gap-6 lg:grid-cols-2">
    <div class="bg-white shadow overflow-hidden sm:rounded-lg">
        <div class="px-4 py-5 sm:px-6">
            <h3 class="text-lg leading-6 font-medium text-gray-900">Agreements</h3>
        </div>
        <div class="border-t border-gray-200">
            <ul class="divide-y divide-gray-200">
                {% for agreement in company.agreements %}
                <li class="px-4 py-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-900">
                                <a href="{{ url_for('clients.uploaded_file', filename=agreement.file_path) }}" target="_blank" class="text-indigo-600 hover:text-indigo-900">
                                    {{ agreement.type.title() }} Agreement
                                </a>
                            </p>
                            <p class="text-sm text-gray-500">
                                Uploaded: {{ agreement.uploaded_at.strftime('%Y-%m-%d') }}
                                {% if agreement.valid_until %}
                                    | Valid until: {{ agreement.valid_until.strftime('%Y-%m-%d') }}
                                    {% if agreement.valid_until < datetime.now().date() %}
                                        <span class="ml-1 text-red-600">(Expired)</span>
                                    {% endif %}
                                {% endif %}
                            </p>
                        </div>
                        <a href="{{ url_for('clients.uploaded_file', filename=agreement.file_path) }}" target="_blank" class="text-red-500 hover:text-red-700">
                            <i class="fas fa-file-pdf"></i>
                        </a>
                    </div>
                </li>
                {% else %}
                <li class="px-4 py-4 text-sm text-gray-500">No agreements uploaded</li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <div class="bg-white shadow overflow-hidden sm:rounded-lg">
        <div class="px-4 py-5 sm:px-6">
            <h3 class="text-lg leading-6 font-medium text-gray-900">Commitments</h3>
        </div>
        <div class="border-t border-gray-200">
            <ul class="divide-y divide-gray-200">
                {% for commitment in company.commitments %}
                <li class="px-4 py-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-900">{{ commitment.media_group.name }}</p>
                            <p class="text-sm text-gray-500">{{ commitment.year }}</p>
                        </div>
                        <p class="text-sm font-medium text-gray-900">{{ commitment.currency }} {{ "{:,.2f}".format(commitment.amount) }}</p>
                    </div>
                </li>
                {% else %}
                <li class="px-4 py-4 text-sm text-gray-500">No commitments yet</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>

{% if not company.parent_company_id %}
<div class="mt-6">
    <div class="bg-white shadow overflow-hidden sm:rounded-lg">
        <div class="px-4 py-5 sm:px-6 flex justify-between items-center">
            <h3 class="text-lg leading-6 font-medium text-gray-900">Subcompanies</h3>
            <a href="{{ url_for('clients.new_subcompany', company_id=company.id) }}" class="text-sm text-indigo-600 hover:text-indigo-500">
                Add Subcompany
            </a>
        </div>
        <div class="border-t border-gray-200">
            <ul class="divide-y divide-gray-200">
                {% for subcompany in company.subcompanies %}
                <li class="px-4 py-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-900">{{ subcompany.name }}</p>
                            <p class="text-sm text-gray-500">
                                {% if subcompany.vat_code %}VAT: {{ subcompany.vat_code }}{% endif %}
                                {% if subcompany.registration_number %}| Reg: {{ subcompany.registration_number }}{% endif %}
                            </p>
                        </div>
                        <a href="{{ url_for('clients.edit_subcompany', company_id=company.id, subcompany_id=subcompany.id) }}" class="text-indigo-600 hover:text-indigo-900 text-sm">
                            Edit →
                        </a>
                    </div>
                </li>
                {% else %}
                <li class="px-4 py-4 text-sm text-gray-500">No subcompanies</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}